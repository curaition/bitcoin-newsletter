# ğŸš€ RENDER DEPLOYMENT GUIDE - HYBRID STRATEGY

## Overview

This guide walks you through deploying the Bitcoin Newsletter backend to Render using the hybrid Render + Neon strategy.

## ğŸ¯ Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HYBRID DEPLOYMENT                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”§ RENDER SERVICES                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   FastAPI API   â”‚  â”‚  Celery Worker  â”‚  â”‚  Celery Beat    â”‚ â”‚
â”‚  â”‚   (Python)      â”‚  â”‚   (Python)      â”‚  â”‚   (Python)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚     Redis       â”‚                                           â”‚
â”‚  â”‚    (Cache)      â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ§  NEON DATABASE (External)                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚   PostgreSQL    â”‚  âœ… Vector Extensions                     â”‚
â”‚  â”‚   + AI Tables   â”‚  âœ… Database Branching                    â”‚
â”‚  â”‚                 â”‚  âœ… Time Travel                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  âœ… Autoscaling                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ STEP-BY-STEP DEPLOYMENT

### Step 1: Access Render Dashboard

1. Go to **https://dashboard.render.com**
2. Sign up or log in with your GitHub account
3. Click **"New +"** â†’ **"Blueprint"**

### Step 2: Connect GitHub Repository

1. **Repository**: `https://github.com/curaition/bitcoin-newsletter.git`
2. **Branch**: `main`
3. **Blueprint File**: `render.yaml` (auto-detected)

### Step 3: Review Services

Render will create these **4 backend services** (frontends will be added later):

#### ğŸŒ Web Services
- **bitcoin-newsletter-api** (FastAPI Backend)
  - Build: `pip install uv && uv pip install -e .`
  - Start: `uv run crypto-newsletter serve --host 0.0.0.0 --port $PORT`
  - Health Check: `/health`

#### ğŸ‘· Worker Services
- **bitcoin-newsletter-worker** (Celery Worker)
  - Build: `pip install uv && uv pip install -e .`
  - Start: `uv run crypto-newsletter worker`

- **bitcoin-newsletter-beat** (Celery Scheduler)
  - Build: `pip install uv && uv pip install -e .`
  - Start: `uv run crypto-newsletter beat`

#### ğŸ—„ï¸ Database Services
- **bitcoin-newsletter-redis** (Redis Cache)
  - Plan: Starter ($7/month)
  - Used for: Celery task queue and results

> **Note**: Frontend services (admin dashboard and consumer app) will be added in Phase 2 after creating the React applications.

### Step 4: Environment Variables

All services will automatically receive these environment variables:

#### âœ… Pre-configured Variables
```bash
# Database (External Neon)
DATABASE_URL=postgresql+asyncpg://neondb_owner:npg_prKBLEUJ1f8P@ep-purple-firefly-ab009z0a-pooler.eu-west-2.aws.neon.tech/neondb

# Redis (Auto-generated by Render)
REDIS_URL=${REDIS_URL}
CELERY_BROKER_URL=${REDIS_URL}
CELERY_RESULT_BACKEND=${REDIS_URL}

# API Configuration
COINDESK_API_KEY=346bed562339e612d8c119b80e25f162386d81bdbe323f381a85eab2f0cb74fb

# Service Configuration
RAILWAY_ENVIRONMENT=production
SERVICE_TYPE=web|worker|beat
LOG_LEVEL=INFO
DEBUG=false
ENABLE_CELERY=true
```

#### ğŸ”§ Optional Variables (Add in Render Dashboard)
```bash
# AI/ML (for future agent workflows)
GEMINI_API_KEY=your_gemini_api_key_here
LANGFUSE_SECRET_KEY=your_langfuse_key_here
LANGFUSE_PUBLIC_KEY=your_langfuse_public_key_here

# Email (for newsletter delivery)
SMTP_USERNAME=your_email@gmail.com
SMTP_PASSWORD=your_app_password
FROM_EMAIL=your_email@gmail.com

# Security
SECRET_KEY=your-secret-key-here
```

### Step 5: Deploy Services

1. Click **"Apply"** to start deployment
2. Monitor build progress for each service
3. Wait for all services to show **"Live"** status

## ğŸ” POST-DEPLOYMENT VERIFICATION

### Step 1: Health Checks

Test these endpoints once deployment completes:

```bash
# Basic health check
curl https://bitcoin-newsletter-api.onrender.com/health

# Expected response:
{
  "status": "healthy",
  "service": "crypto-newsletter",
  "timestamp": "2025-08-12T23:45:00.000Z"
}

# Detailed health check
curl https://bitcoin-newsletter-api.onrender.com/health/detailed

# API documentation
open https://bitcoin-newsletter-api.onrender.com/docs
```

### Step 2: Verify Database Connection

```bash
# Check database statistics
curl https://bitcoin-newsletter-api.onrender.com/admin/stats

# Expected response:
{
  "timestamp": "2025-08-12T23:45:00.000Z",
  "service": "crypto-newsletter",
  "environment": "production",
  "statistics": {
    "total_articles": 25,
    "recent_articles_24h": 5,
    "total_publishers": 4,
    "total_categories": 18
  }
}
```

### Step 3: Test Article Ingestion

```bash
# Trigger manual ingestion
curl -X POST https://bitcoin-newsletter-api.onrender.com/admin/ingest \
  -H "Content-Type: application/json" \
  -d '{"limit": 5, "hours_back": 24}'

# Expected response:
{
  "success": true,
  "results": {
    "articles_fetched": 5,
    "articles_processed": 5,
    "duplicates_skipped": 0,
    "success_rate": 1.0
  }
}
```

### Step 4: Monitor Celery Tasks

```bash
# Check system status (includes Celery)
curl https://bitcoin-newsletter-api.onrender.com/admin/status

# Expected response includes:
{
  "celery": {
    "enabled": true,
    "workers": {"status": "healthy", "active_workers": 1},
    "active_tasks": {...}
  }
}
```

## ğŸ“Š Service URLs

After deployment, your services will be available at:

- **API**: `https://bitcoin-newsletter-api.onrender.com`
- **API Docs**: `https://bitcoin-newsletter-api.onrender.com/docs`
- **Health Check**: `https://bitcoin-newsletter-api.onrender.com/health`
- **Admin Panel**: `https://bitcoin-newsletter-api.onrender.com/admin/status`

## ğŸ”§ Monitoring & Logs

### Render Dashboard
- **Service Logs**: View real-time logs for each service
- **Metrics**: Monitor CPU, memory, and request metrics
- **Deployments**: Track deployment history and status

### Application Monitoring
- **Health Endpoints**: Built-in health checks
- **Admin Dashboard**: System statistics and status
- **Celery Monitoring**: Task queue status and metrics

## ğŸ’° Cost Breakdown

### Monthly Costs (Backend Only - Starter Plans)
```
Render Services (Phase 1):
â”œâ”€â”€ FastAPI API: $7/month
â”œâ”€â”€ Celery Worker: $7/month
â”œâ”€â”€ Celery Beat: $7/month
â”œâ”€â”€ Redis: $7/month
â””â”€â”€ Total Render: $28/month

External Services:
â”œâ”€â”€ Neon PostgreSQL: $19-69/month (scales with usage)
â””â”€â”€ Total External: $19-69/month

PHASE 1 TOTAL: $47-97/month

Future Frontend Addition (Phase 2):
â”œâ”€â”€ Admin Dashboard: $0-7/month (Free to Starter)
â”œâ”€â”€ Consumer Frontend: $0-7/month (Free to Starter)
â””â”€â”€ Frontend Total: $0-14/month

FULL SYSTEM TOTAL: $47-111/month
```

## ğŸš€ Next Steps

### Phase 1: Backend Verification (Current)
- âœ… Verify all services are running
- âœ… Test API endpoints
- âœ… Confirm automated article ingestion
- âœ… Monitor Celery task processing

### Phase 2: Frontend Development (Next)
- ğŸ“± Create React admin dashboard
- ğŸŒ Create React consumer frontend
- ğŸ”— Integrate with deployed API
- ğŸš€ Deploy frontends to Render

### Phase 3: AI Agent Implementation (Future)
- ğŸ¤– Implement signal detection agents
- ğŸ” Add research validation workflows
- âœï¸ Build newsletter generation agents
- ğŸ“Š Create monitoring dashboard

## ğŸ†˜ Troubleshooting

### Common Issues

#### Build Failures
```bash
# Check build logs in Render dashboard
# Common fixes:
# 1. Verify pyproject.toml dependencies
# 2. Check UV installation in build command
# 3. Ensure Python 3.11+ compatibility
```

#### Database Connection Issues
```bash
# Verify DATABASE_URL format
# Should be: postgresql+asyncpg://user:pass@host:port/db
# Check Neon database is accessible
# Verify environment variables are set
```

#### Celery Task Issues
```bash
# Check Redis connection
# Verify CELERY_BROKER_URL is set
# Monitor worker service logs
# Check beat service is scheduling tasks
```

## ğŸ‰ Success Criteria

Your deployment is successful when:

- âœ… All 4 services show "Live" status in Render
- âœ… Health check returns 200 OK
- âœ… API documentation is accessible
- âœ… Manual article ingestion works
- âœ… Automated tasks are scheduled (every 4 hours)
- âœ… Database queries return data
- âœ… No error logs in service monitoring

**Ready to deploy? Go to https://dashboard.render.com and follow the steps above!**
